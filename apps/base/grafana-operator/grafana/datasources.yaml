apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: victoria-metrics
spec:
  datasource:
    name: VictoriaMetrics
    uid: prometheus
    type: prometheus
    jsonData:
      timeInterval: 5s
      tlsSkipVerify: true
    url: http://vmselect-vmks-victoria-metrics-k8s-stack:8481/select/0/prometheus
    access: proxy
  instanceSelector:
    matchLabels:
      dashboards: homelab
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: alertmanager
spec:
  datasource:
    name: AlertManager
    uid: alertmanager
    type: alertmanager
    jsonData:
      timeInterval: 5s
      tlsSkipVerify: true
      implementation: prometheus
      # Whether or not Grafana should send alert instances to this Alertmanager
      handleGrafanaManagedAlerts: false

    url: http://vmalertmanager-vmks-victoria-metrics-k8s-stack:9093
    access: proxy
  instanceSelector:
    matchLabels:
      dashboards: homelab
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: github
spec:
  valuesFrom:
    - targetPath: "jsonData.appId"
      valueFrom:
        secretKeyRef:
          name: grafana-github-datasource
          key: app_id
    - targetPath: "jsonData.installationId"
      valueFrom:
        secretKeyRef:
          name: grafana-github-datasource
          key: installation_id
    - targetPath: "secureJsonData.privateKey"
      valueFrom:
        secretKeyRef:
          name: grafana-github-datasource
          key: private_key
  datasource:
    name: GitHub
    uid: github
    access: proxy
    type: &datasource grafana-github-datasource
    jsonData:
      selectedAuthType: github-app
      appId: "${app_id}"
      installationId: "${installation_id}"
    secureJsonData:
      privateKey: "${private_key}"
  instanceSelector:
    matchLabels:
      dashboards: homelab
  plugins:
    - name: *datasource
      version: 2.3.0
---

